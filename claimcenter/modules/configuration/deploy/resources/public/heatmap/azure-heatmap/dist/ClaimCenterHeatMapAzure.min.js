!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ClaimCenterHeatMapAzure=t():e.ClaimCenterHeatMapAzure=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>B}),void 0===window.mapName&&(window.mapName=""),void 0===window.credential&&(window.credential=""),void 0===window.selectionMessageNodeID&&(window.selectionMessageNodeID=null),void 0===window.refreshUponSelection&&(window.refreshUponSelection=!1),void 0===window.zoom&&(window.zoom=4),void 0===window.autoScale&&(window.autoScale=!1),void 0===window.centerLatLong&&(window.centerLatLong=null),void 0===window._margin&&(window._margin=10),void 0===window._boundingBoxWidth&&(window._boundingBoxWidth=0),void 0===window._boundingBoxHeight&&(window._boundingBoxHeight=0),void 0===window.MAX_ZOOM&&(window.MAX_ZOOM=19),void 0===window.haveLegendImage&&(window.haveLegendImage=!1),void 0===window.popupMapWidth&&(window.popupMapWidth=800),void 0===window.popupMapHeight&&(window.popupMapHeight=600),void 0===window.popupMapElementName&&(window.popupMapElementName="popupMapLink"),void 0===window.cantLoadMapMessage&&(window.cantLoadMapMessage="Could not load Azure Maps SDK."),void 0===window.selectionColor&&(window.selectionColor="rgba(0, 150, 255, 0.3)"),void 0===window.selectionPoint1&&(window.selectionPoint1=null),void 0===window.selectionPoint2&&(window.selectionPoint2=null),void 0===window.areaOfInterestColor&&(window.areaOfInterestColor="rgba(247, 242, 242, 0.85)"),void 0===window.areaOfInterestPoint1&&(window.areaOfInterestPoint1=null),void 0===window.areaOfInterestPoint2&&(window.areaOfInterestPoint2=null),void 0===window.map&&(window.map=null),void 0===window.url&&(window.url="./MapOverlay.do"),void 0===window.height&&(window.height=0),void 0===window.width&&(window.width=0),void 0===window.messageElement&&(window.messageElement=null),void 0===window.x&&(window.x=0),void 0===window.y&&(window.y=0),void 0===window.drawingDataSource&&(window.drawingDataSource=null),void 0===window.selectionPolygonLayer&&(window.selectionPolygonLayer=null),void 0===window.aoiDataSource&&(window.aoiDataSource=null),void 0===window.aoiPolygonLayer&&(window.aoiPolygonLayer=null),void 0===window.tooltipPopup&&(window.tooltipPopup=null),void 0===window.drawingManager&&(window.drawingManager=null),void 0===window.geolocationControl&&(window.geolocationControl=null);var n=function(e){return Math.round(1e5*e)/1e5},a=function(e){for(var t=window.parent.document.getElementsByTagName("*"),n=0;n<t.length;n++){var a=t[n],o=a.id.indexOf(e);if(-1!==o&&o+e.length===a.id.length)return a}return null},o=function(e){var t=0;for(e>>=1;e>0;)e>>=1,t++;return t},i=function(e){if(!e)return"";var t=document.createElement("div");t.innerHTML=e;for(var n=t.querySelectorAll("a[data-gw-claimnumber]"),a=0;a<n.length;a++){var o=n[a],i=o.getAttribute("data-gw-claimnumber");o.setAttribute("onclick",'heatMap.onClaimNumberClick("'+i+'"); return false;'),o.setAttribute("href","javascript:void(0);"),o.style.color="#0078d4",o.style.textDecoration="underline",o.style.cursor="pointer"}return t.innerHTML},r=function(){if(window.parent&&window.parent.gw&&window.parent.gw.globals&&window.parent.gw.globals.gwAjax&&"function"==typeof window.parent.gw.globals.gwAjax.getCsrfToken){var e=window.parent.gw.globals.gwAjax.getCsrfToken();if(e)return e}return t="csrfToken",(2===(n="; ".concat(document.cookie).split("; ".concat(t,"="))).length?n.pop().split(";").shift():null)||"";var t,n},l={SELECTION_FILL:"rgba(0, 150, 255, 0.3)",SELECTION_STROKE:"rgba(0, 150, 255, 1)",AOI_FILL:"rgba(247, 242, 242, 0.5)",AOI_STROKE:"rgb(189, 188, 188)",CLAIM_MARKER:"blue",CLAIM_MARKER_STROKE:"rgba(13, 13, 13, 0.5)",GEOLOCATION_MARKER:"#007bff",getSelectionFill:function(){return"string"==typeof window.selectionColor?window.selectionColor:l.SELECTION_FILL},getSelectionStroke:function(){return"string"==typeof window.selectionColor?window.selectionColor:l.SELECTION_STROKE},getAoiFill:function(){return"string"==typeof window.areaOfInterestColor?window.areaOfInterestColor:l.AOI_FILL},getAoiStroke:function(){return l.AOI_STROKE},getClaimMarker:function(){return l.CLAIM_MARKER},getClaimMarkerStroke:function(){return l.CLAIM_MARKER_STROKE},getGeolocationMarker:function(){return l.GEOLOCATION_MARKER}};function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function d(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}var u=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heatMap=t},(t=[{key:"initializeMap",value:function(){var e=this.heatMap.convertToAzurePoint(window.centerLatLong,"centerLatLong")||[-98.5795,39.8283],t=window.autoScale?window.zoom:void 0!==window.zoomLevel?window.zoomLevel:window.zoom;this.heatMap.map=new atlas.Map("mapDiv",{center:e,zoom:t,authOptions:{authType:"subscriptionKey",subscriptionKey:window.credential}}),document.getElementById("mapDiv").style.cursor="pointer",this.heatMap.tooltipPopup=new atlas.Popup({pixelOffset:[0,-18],closeButton:!0,fillColor:"white",shadowColor:"gray",shadowBlur:10,shadowOffsetX:2,shadowOffsetY:2,position:[0,0],showPointer:!0,pointerColor:"white",pointerWidth:14,pointerHeight:12,textWrappingWidth:300,maxWidth:300,contentStyle:{padding:"15px",maxWidth:"300px",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"}}),window.map=this.heatMap.map,this.heatMap.map.events.add("ready",this.onMapReady.bind(this)),this.heatMap.map.events.add("click",this.heatMap.handleGlobalMapClick.bind(this.heatMap)),this.heatMap.map.events.add("moveend",this.heatMap.handleMapViewChanged.bind(this.heatMap)),this.heatMap.map.events.add("zoomend",this.heatMap.handleMapViewChanged.bind(this.heatMap)),this.heatMap.map.events.add("dragend",this.heatMap.handleMapViewChanged.bind(this.heatMap))}},{key:"onMapReady",value:function(){this.addMapControls(),this.initializeDrawingTools(),this.initializeDataSources(),this.drawInitialShapes(),this.heatMap.loadBeforeSavedDrawing(),this.heatMap.onResize()}},{key:"addMapControls",value:function(){var e=this.heatMap.map;e.controls.add(new atlas.control.StyleControl({mapStyles:"all"}),{position:"top-right"}),e.controls.add(new atlas.control.GeolocationControl({style:"auto",showUserLocation:!0,trackUserLocation:!1,updateMapCamera:!0,markerColor:l.getGeolocationMarker()}),{position:"top-right"}),e.controls.add(new atlas.control.ZoomControl,{position:"top-right"})}},{key:"initializeDrawingTools",value:function(){this.heatMap.drawingManager=new atlas.drawing.DrawingManager(this.heatMap.map,{toolbar:new atlas.control.DrawingToolbar({buttons:["draw-rectangle"],position:"top-right"}),rectangleOptions:{strokeWidth:2,strokeOpacity:1,draggable:!1,strokeColor:"rgb(0, 150, 0)",fill:!1,fillColor:"transparent"},polygonOptions:{fillOpacity:0,strokeWidth:2,strokeOpacity:1,draggable:!1,strokeColor:"rgb(0, 150, 0)",fill:!1,fillColor:"transparent"}}),window.drawingManager=this.heatMap.drawingManager,this.heatMap.map.events.add("drawingmodechanged",this.heatMap.drawingManager,this.heatMap.handleDrawingModeChanged.bind(this.heatMap)),this.heatMap.map.events.add("drawingcomplete",this.heatMap.drawingManager,this.heatMap.handleDrawingComplete.bind(this.heatMap))}},{key:"initializeDataSources",value:function(){var e=this.heatMap.map;this.heatMap.drawingDataSource=new atlas.source.DataSource,e.sources.add(this.heatMap.drawingDataSource),this.heatMap.selectionPolygonLayer=new atlas.layer.PolygonLayer(this.heatMap.drawingDataSource,null,{fillOpacity:.3,strokeWidth:2,strokeThickness:2,fill:!1,fillColor:"transparent",strokeColor:"rgb(0, 150, 0)"}),e.layers.add(this.heatMap.selectionPolygonLayer),this.heatMap.selectionLineLayer=new atlas.layer.LineLayer(this.heatMap.drawingDataSource,null,{strokeWidth:2,strokeDashArray:[1,0],strokeOpacity:1,fill:!1,fillColor:"transparent",strokeColor:"rgb(0, 150, 0)"}),e.layers.add(this.heatMap.selectionLineLayer),window.selectionPolygonLayer=this.heatMap.selectionPolygonLayer,this.heatMap.aoiDataSource=new atlas.source.DataSource,e.sources.add(this.heatMap.aoiDataSource),window.aoiDataSource=this.heatMap.aoiDataSource,this.heatMap.claimSymbolsDataSource=new atlas.source.DataSource,e.sources.add(this.heatMap.claimSymbolsDataSource),this.heatMap.claimSymbolLayer=new atlas.layer.BubbleLayer(this.heatMap.claimSymbolsDataSource,"claimSymbolLayer",{color:l.getClaimMarker(),radius:20,strokeColor:l.getClaimMarkerStroke(),strokeWidth:3,filter:["any",["==",["geometry-type"],"Point"]],opacity:.85}),e.layers.add(this.heatMap.claimSymbolLayer);var t=new atlas.layer.TileLayer({tileUrl:window.url+"?tile={quadkey}.png&mapName="+window.mapName,tileSize:256});e.layers.add(t),this.heatMap.aoiPolygonLayer=new atlas.layer.PolygonLayer(this.heatMap.aoiDataSource,null,{strokeColor:l.getAoiStroke(),strokeWidth:2,strokeThickness:2,opacity:.7,fill:!1,fillColor:"transparent"}),e.layers.add(this.heatMap.aoiPolygonLayer),this.heatMap.aoiLineLayer=new atlas.layer.LineLayer(this.heatMap.aoiDataSource,null,{strokeColor:l.getAoiStroke(),strokeWidth:2,strokeDashArray:[1,0],strokeOpacity:1,fill:!1,fillColor:"transparent"}),e.layers.add(this.heatMap.aoiLineLayer),window.aoiPolygonLayer=this.heatMap.aoiPolygonLayer,window.drawingDataSource=this.heatMap.drawingDataSource}},{key:"drawInitialShapes",value:function(){var e=this.heatMap.convertToAzurePoint(window.selectionPoint1,"selectionPoint1"),t=this.heatMap.convertToAzurePoint(window.selectionPoint2,"selectionPoint2");e&&t&&this.heatMap.addRectangleToDataSource(this.heatMap.drawingDataSource,e,t);var n=this.heatMap.convertToAzurePoint(window.areaOfInterestPoint1,"areaOfInterestPoint1"),a=this.heatMap.convertToAzurePoint(window.areaOfInterestPoint2,"areaOfInterestPoint2");n&&a&&this.heatMap.addRectangleToDataSource(this.heatMap.aoiDataSource,n,a)}}])&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();const p=u;function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function w(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,g(a.key),a)}}function g(e){var t=function(e,t){if("object"!=h(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=h(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==h(t)?t:t+""}var y=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heatMap=t},t=[{key:"handleGlobalMapClick",value:function(e){var t=e.position;if(!t||!Array.isArray(t)||t.length<2)console.error("Invalid position in global click event:",t);else{this.clearToolTip();var n=t[0],a=t[1];this.getClaimTooltip(a,n)}}},{key:"getClaimTooltip",value:function(e,t){var a=this,o="?ttLat=".concat(n(e),"&ttLng=").concat(n(t)),i=r();i&&(o+="&CSRFToken=".concat(i)),this.heatMap.postToServer(o,(function(n){if(n&&""!==n.trim()){var o=n.indexOf("|");if(o>0){var i=n.indexOf(","),r=n.substring(0,i),l=n.substring(i+1,o),s=n.substring(o+1),c=[parseFloat(l),parseFloat(r)];a.showToolTip(s,c)}else a.showToolTip(n,[t,e])}}))}},{key:"showToolTip",value:function(e,t){if(e&&t){var n,a,o=e.indexOf("|");if(o>0){var r=e.indexOf(","),l=parseFloat(e.substring(0,r)),s=parseFloat(e.substring(r+1,o));isNaN(l)||isNaN(s)||l<-90||l>90||s<-180||s>180?(console.error("Invalid coordinates from server:",l,s),n=t):n=[s,l],a=e.substring(o+1)}else n=t,a=e;var c=this.heatMap.tooltipPopup||window.tooltipPopup;if(c){var d=i(a);c.setOptions({content:'<div style="padding: 15px; max-width: 300px; word-wrap: break-word; overflow-wrap: break-word; white-space: normal;">'.concat(d,"</div>"),position:n,pixelOffset:[0,-15]}),c.open(window.map||this.heatMap.map),window.tooltipPopup=c}else console.error("Tooltip popup not initialized")}else console.error("Invalid parameters for showToolTip")}},{key:"clearToolTip",value:function(){var e=this.heatMap.tooltipPopup||window.tooltipPopup;e&&e.close()}}],t&&w(e.prototype,t),a&&w(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}();const f=y;function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,M(a.key),a)}}function M(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=m(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}var b=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.heatMap=t},t=[{key:"handleDrawingModeChanged",value:function(e){if(e&&"string"==typeof e&&e.startsWith("draw"))try{if(this.heatMap.drawingManager&&this.heatMap.drawingManager.getSource&&this.heatMap.drawingManager.getSource().clear(),this.heatMap.drawingDataSource&&this.heatMap.drawingDataSource.clear(),this.heatMap.drawingManager&&this.heatMap.drawingManager.getLayers){var t=this.heatMap.drawingManager.getLayers();t&&(t.polygonLayer&&t.polygonLayer.setOptions({fillOpacity:0,strokeColor:"string"==typeof window.selectionColor?window.selectionColor:"rgb(19, 20, 19)"}),t.polygonOutlineLayer&&t.polygonOutlineLayer.setOptions({opacity:0,strokeColor:"string"==typeof window.selectionColor?window.selectionColor:"rgb(0, 7, 0)"}))}window.selectionPoint1=null,window.selectionPoint2=null,this.heatMap.aoiDataSource&&this.heatMap.aoiDataSource.clear(),this.heatMap.tooltipManager&&this.heatMap.tooltipManager.clearToolTip()}catch(e){console.error("Error clearing drawing canvas:",e)}else e&&e.drawingMode&&(this.heatMap.tooltipManager&&this.heatMap.tooltipManager.clearToolTip(),this.heatMap.drawingDataSource&&this.heatMap.drawingDataSource.clear(),window.selectionPoint1=null,window.selectionPoint2=null,this.heatMap.aoiDataSource&&this.heatMap.aoiDataSource.clear(),this.heatMap.aoiPolygonLayer&&this.heatMap.aoiPolygonLayer.setOptions({opacity:0}))}},{key:"handleDrawingComplete",value:function(e){this.heatMap.drawingManager&&this.heatMap.drawingManager.setOptions({mode:"idle"});var t=null;if(e&&e.data&&e.data.geometry&&e.data.geometry.coordinates?t=e.data.geometry.coordinates[0]:e&&e.drawing&&e.drawing.getCoordinates&&(t=e.drawing.getCoordinates()[0]),t&&t.length){this.heatMap.tooltipManager&&this.heatMap.tooltipManager.clearToolTip(),e.data?this.heatMap.drawingDataSource.add(e):e.drawing&&this.heatMap.drawingDataSource.add(e.drawing);for(var n=Number.MAX_VALUE,a=Number.MAX_VALUE,o=-Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0;r<t.length;r++){var l=t[r][0],s=t[r][1];n=Math.min(n,l),a=Math.min(a,s),o=Math.max(o,l),i=Math.max(i,s)}window.selectionPoint1={longitude:n,latitude:i},window.selectionPoint2={longitude:o,latitude:a},this.saveRectangleCoordinates(),this.triggerSearchWithBounds(n,a,o,i)}else console.warn("Drawing event doesn't match expected structure:",e)}},{key:"saveRectangleCoordinates",value:function(){var e=this;if(window.selectionPoint1&&window.selectionPoint2){var t="?point1Lng="+n(window.selectionPoint1.longitude)+"&point1Lat="+n(window.selectionPoint1.latitude)+"&point2Lng="+n(window.selectionPoint2.longitude)+"&point2Lat="+n(window.selectionPoint2.latitude);this.heatMap.postToServer(t,(function(t){var n=window.messageElement||e.heatMap.messageElement;n&&t&&(n.innerHTML=t)}))}else console.error("Cannot save rectangle: missing selection points")}},{key:"triggerSearchWithBounds",value:function(e,t,a,o){var i="Searching within: North: "+n(o)+", South: "+n(t)+", East: "+n(a)+", West: "+n(e),r=window.messageElement||this.heatMap.messageElement;r&&(r.innerHTML=i);var l="?point1Lat="+n(t)+"&point1Lng="+n(e)+"&point2Lat="+n(o)+"&point2Lng="+n(a);this.heatMap.postToServer(l,this.handleSearchResponse.bind(this))}},{key:"handleSearchResponse",value:function(e){var t=window.messageElement||this.heatMap.messageElement;t&&e&&(t.innerHTML=e);try{var n;if(e&&e.trim().startsWith("{")){n=JSON.parse(e);var a=window.azureHeatMapModule||{},o=a.getClaimDataSource?a.getClaimDataSource():this.heatMap.claimSymbolsDataSource;o&&n&&n.claims?(o.clear(),n.claims.forEach((function(e){if(e.latitude&&e.longitude){var t=new atlas.data.Feature(new atlas.data.Point([parseFloat(e.longitude),parseFloat(e.latitude)]),{claimNumber:e.claimNumber||"",claimId:e.claimId||"",policyNumber:e.policyNumber||"",title:e.claimNumber||"Claim",claimData:e});o.add(t)}}))):console.error("Failed to add claims: claimDataSource not available or data format incorrect",{hasDataSource:!!o,hasClaimData:!!n,hasClaimsArray:!(!n||!n.claims)})}}catch(e){console.error("Error processing claim data:",e)}window.refreshUponSelection&&(window.parent&&window.parent.gw&&window.parent.gw.globals&&window.parent.gw.globals.gwUtil&&"function"==typeof window.parent.gw.globals.gwUtil.refresh?window.parent.gw.globals.gwUtil.refresh():console.error("Guidewire refresh function (window.parent.gw.globals.gwUtil.refresh) not found. Cannot refresh."))}}],t&&v(e.prototype,t),a&&v(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}();const S=b;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function P(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,D(a.key),a)}}function O(e,t,n){return(t=D(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){var t=function(e,t){if("object"!=L(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=L(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==L(t)?t:t+""}var T=function(){return e=function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.instance)return e.instance;e.instance=this,this.mapRenderer=new p(this),this.tooltipManager=new f(this),this.searchManager=new S(this),this.width=0,this.height=0,this.messageElement=null,this.x=0,this.y=0,this.map=null,this.drawingDataSource=null,this.selectionPolygonLayer=null,this.aoiDataSource=null,this.aoiPolygonLayer=null,this.tooltipPopup=null,this.drawingManager=null,this.geolocationControl=null,this.claimSymbolsDataSource=null,this.claimSymbolLayer=null,this.onResize=this.onResize.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleGlobalMapClick=this.handleGlobalMapClick.bind(this),this.handleMapViewChanged=this.handleMapViewChanged.bind(this),this.handleDrawingModeChanged=this.handleDrawingModeChanged.bind(this),this.handleDrawingComplete=this.handleDrawingComplete.bind(this)},t=[{key:"LoadMap",value:function(){"function"==typeof initMap&&initMap(),this.messageElement=null!=window.selectionMessageNodeID?a(window.selectionMessageNodeID):null;var e=a(window.popupMapElementName);null!=e&&(e.onclick=function(){window.open("./MapOverlay.do?map.html=iframe&mapName=".concat(window.mapName),"popupMap","width=".concat(window.popupMapWidth,",height=").concat(window.popupMapHeight,",status=yes,menubar=yes,resizable=yes"),!0).focus()}),""===window.parent.name&&(window.parent.name="plugh");var t=document.getElementById("loading_msg");"undefined"!=typeof atlas?(t&&t.parentNode.removeChild(t),this.getMapSize(),window.autoScale&&(window.zoom=this.computeZoom()),this.mapRenderer.initializeMap(),this.setupEventListeners()):t&&(t.textContent=window.cantLoadMapMessage||"Azure Maps SDK not loaded.")}},{key:"setupEventListeners",value:function(){var e=this;null==window.event&&this.listen(),window.addEventListener&&(window.addEventListener("resize",this.onResize,!1),document.addEventListener("keydown",this.handleKeyDown,!1)),window.addEventListener("beforeunload",(function(){return e.UnloadMap()}))}},{key:"listen",value:function(){window.addEventListener&&document.addEventListener("keydown",this.handleKeyDown,!1)}},{key:"handleKeyDown",value:function(e){var t=e.key||e.keyCode;if("Escape"===t||27===t)return this.tooltipManager.clearToolTip(),this.drawingManager&&this.drawingManager.getDrawingMode()&&this.drawingManager.setOptions({mode:null}),e.preventDefault(),!1}},{key:"loadBeforeSavedDrawing",value:function(){if(window.selectionPoint1&&window.selectionPoint2&&this.drawingManager){var e=window.selectionPoint1.longitude,t=window.selectionPoint1.latitude,n=window.selectionPoint2.longitude,a=window.selectionPoint2.latitude,o=this.drawingManager.getSource(),i={type:"Feature",properties:{subType:"Rectangle",color:"string"==typeof window.selectionColor?window.selectionColor:"rgb(0, 15, 0)",strokeColor:"rgb(1, 19, 1)"},geometry:{type:"Polygon",coordinates:[[[e,t],[n,t],[n,a],[e,a],[e,t]]]}};o.add(i)}}},{key:"UnloadMap",value:function(){this.map&&"function"==typeof this.map.dispose&&(this.map.dispose(),this.map=null,this.drawingManager=null,this.tooltipPopup=null,this.selectionPolygonLayer=null,this.aoiPolygonLayer=null,this.claimSymbolLayer=null,this.drawingDataSource=null,this.aoiDataSource=null,this.claimSymbolsDataSource=null)}},{key:"convertToAzurePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?Array.isArray(e)&&2===e.length?e:"object"===L(e)&&"longitude"in e&&"latitude"in e?[e.longitude,e.latitude]:(console.error("Cannot convert ".concat(t," to Azure point format:"),e),null):null}},{key:"handleGlobalMapClick",value:function(e){this.tooltipManager.handleGlobalMapClick(e)}},{key:"handleMapViewChanged",value:function(){if(this.map){var e=this.map.getCamera();this.tooltipManager&&this.tooltipManager.clearToolTip(),this.updateZoom(e.zoom),this.updateCenter()}}},{key:"updateCenter",value:function(){if(this.map){var e=this.map.getCamera().center;if(e){var t=parseFloat(e[1]).toFixed(5),n=parseFloat(e[0]).toFixed(5);this.postToServer("?centerLat="+t+"&centerLng="+n)}}}},{key:"updateZoom",value:function(e){if(isNaN(e))console.error("Invalid zoom level:",e);else{window.zoom=e;var t=Math.floor(e),n="?zoomLevel=".concat(t);window.mapName&&(n+="&mapName=".concat(window.mapName)),this.postToServer(n)}}},{key:"handleDrawingModeChanged",value:function(e){this.searchManager.handleDrawingModeChanged(e)}},{key:"handleDrawingComplete",value:function(e){this.searchManager.handleDrawingComplete(e)}},{key:"getMapSize",value:function(){var e=document.getElementById("mapDiv");e?(this.width=e.clientWidth,this.height=e.clientHeight,window.width=this.width,window.height=this.height):(console.error("Map container 'mapDiv' not found."),this.width=0,this.height=0)}},{key:"onResize",value:function(){this.getMapSize()}},{key:"computeZoom",value:function(){var e;this.getMapSize();var t=-1;if(0!=window._boundingBoxHeight&&(t=(this.height-2*window._margin<<window.MAX_ZOOM)/window._boundingBoxHeight),0!=window._boundingBoxWidth){var n=(this.width-2*window._margin<<window.MAX_ZOOM)/window._boundingBoxWidth;t=0!=window._boundingBoxHeight?Math.min(t,n):n}return(e=-1!=t?o(t):0)>window.MAX_ZOOM&&(e=window.MAX_ZOOM),e}},{key:"addRectangleToDataSource",value:function(e,t,n){if(e&&t&&n)if(Array.isArray(t)&&2===t.length&&Array.isArray(n)&&2===n.length){var a=t[0],o=t[1],i=n[0],r=n[1],l=[[[a,o],[a,r],[i,r],[i,o],[a,o]]],s=new atlas.data.Polygon(l);if(e.add(s),e===this.aoiDataSource&&this.aoiPolygonLayer){var c=this.aoiPolygonLayer.getOptions()||{};this.aoiPolygonLayer.setOptions(C(C({},c),{},{strokeWidth:2,strokeThickness:2}))}else if(e===this.drawingDataSource&&this.selectionPolygonLayer){var d=this.selectionPolygonLayer.getOptions()||{};this.selectionPolygonLayer.setOptions(C(C({},d),{},{strokeWidth:2,strokeThickness:2}))}}else console.error("Invalid points format for addRectangleToDataSource. Expected [lon, lat].",t,n);else console.error("Cannot add rectangle: Missing data source or points.")}},{key:"postToServer",value:function(e,t){var n=this,a=new XMLHttpRequest,o=e;e.includes("CSRFToken=")&&(o=e.split("&").filter((function(e){return!e.startsWith("CSRFToken=")})).join("&"));var i=window.url+o;void 0!==window.mapName&&window.mapName&&(i+=(o.includes("?")?"&":"?")+"mapName="+window.mapName),a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded");var l=r(),s=window.parent&&window.parent.gw&&window.parent.gw.globals&&window.parent.gw.globals.gwUtil&&window.parent.gw.globals.gwUtil.CSRF_PARAM_NAME?window.parent.gw.globals.gwUtil.CSRF_PARAM_NAME:"CSRFToken";t&&(a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status)try{t.call(n,a.responseText)}catch(e){console.error("Error executing postToServer callback:",e)}else{console.error("AJAX Error. Status:",a.status,"Response:",a.statusText);try{t.call(n,"")}catch(e){console.error("Error executing postToServer error callback:",e)}}}),l?a.send(s+"="+l):a.send(".")}},{key:"onClaimNumberClick",value:function(e){if(e){var t="./ClaimSummaryLink.do?claimNumber="+e;window.parent&&"plugh"===window.parent.name?window.parent.location=t:window.open(t,"_blank")}}}],t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();O(T,"instance",null);const _=T;function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function A(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,N(a.key),a)}}function N(e){var t=function(e,t){if("object"!=E(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=E(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==E(t)?t:t+""}var R,I,z,x=null,j=function(){return x||(x=new _,window.HeatMap.instance=x),x},W=function(){return e=function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),e.instance?e.instance:(e.instance=this,this._heatMapInstance=null,this)},t=[{key:"_instance",get:function(){return this._heatMapInstance||(this._heatMapInstance=j()),this._heatMapInstance}},{key:"LoadMap",value:function(){this._instance.LoadMap()}},{key:"UnloadMap",value:function(){this._instance&&this._instance.UnloadMap()}},{key:"addRectangleToDataSource",value:function(e,t,n){this._instance&&this._instance.addRectangleToDataSource(e,t,n)}},{key:"handleGlobalMapClick",value:function(e){this._instance&&this._instance.handleGlobalMapClick(e)}},{key:"showToolTip",value:function(e,t){this._instance&&this._instance.tooltipManager&&this._instance.tooltipManager.showToolTip(e,t)}},{key:"getClaimTooltip",value:function(e,t){this._instance&&this._instance.tooltipManager&&this._instance.tooltipManager.getClaimTooltip(e,t)}},{key:"processPopupContent",value:function(e){return i(e)}},{key:"onClaimNumberClick",value:function(e){this._instance&&this._instance.onClaimNumberClick(e)}},{key:"handleKeyDown",value:function(e){this._instance&&this._instance.handleKeyDown(e)}},{key:"clearToolTip",value:function(){this._instance&&this._instance.tooltipManager&&this._instance.tooltipManager.clearToolTip()}},{key:"handleDrawingModeChanged",value:function(e){this._instance&&this._instance.handleDrawingModeChanged(e)}},{key:"handleDrawingComplete",value:function(e){this._instance&&this._instance.handleDrawingComplete(e)}},{key:"saveRectangleCoordinates",value:function(){this._instance&&this._instance.searchManager&&this._instance.searchManager.saveRectangleCoordinates()}},{key:"triggerSearchWithBounds",value:function(e,t,n,a){this._instance&&this._instance.searchManager&&this._instance.searchManager.triggerSearchWithBounds(e,t,n,a)}},{key:"handleSearchResponse",value:function(e){this._instance&&this._instance.searchManager&&this._instance.searchManager.handleSearchResponse(e)}},{key:"postToServer",value:function(e,t){this._instance&&this._instance.postToServer(e,t)}},{key:"updateZoom",value:function(e){this._instance&&this._instance.updateZoom(e)}},{key:"updateCenter",value:function(){this._instance&&this._instance.updateCenter()}},{key:"clip",value:function(e,t,n){return function(e,t,n){return e<t?t:e>n?n:e}(e,t,n)}},{key:"setOpacity",value:function(e,t){!function(e,t){e.style.opacity=t.toFixed(2)}(e,t)}},{key:"logBase2",value:function(e){return o(e)}},{key:"getMapSize",value:function(){if(this._instance)return this._instance.getMapSize()}},{key:"onResize",value:function(){this._instance&&this._instance.onResize()}},{key:"computeZoom",value:function(){return this._instance?this._instance.computeZoom():0}},{key:"digits5",value:function(e){return n(e)}},{key:"findByIDSuffix",value:function(e){return a(e)}},{key:"loadBeforeSavedDrawing",value:function(){this._instance&&this._instance.loadBeforeSavedDrawing()}},{key:"convertToAzurePoint",value:function(e,t){return this._instance?this._instance.convertToAzurePoint(e,t):null}}],t&&A(e.prototype,t),r&&A(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();R=W,z=null,(I=N(I="instance"))in R?Object.defineProperty(R,I,{value:z,enumerable:!0,configurable:!0,writable:!0}):R[I]=z,window.HeatMap=W,window.heatMap=new window.HeatMap;const B=j;return t=t.default})()));